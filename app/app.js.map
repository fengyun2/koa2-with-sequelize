{"version":3,"sources":["../src/app.js"],"names":[],"mappings":"AAAA;;;;;;;AAOA;;;AAGA,a;AACA,4B;AACA,0B;AACA,uC;AACA,4B;AACA,qC;AACA,yC;AACA,mC;AACA,+C;AACA,uC;AACA,gD;AACA,yC;AACA,wD;AACA,mE;;;;;;;AAOA,2C;;;;AAIA,kD,8FATA,U,CAEA;AACA;AAQA,IAAM,MAAM,mBAAZ,C,CAJA;;AAMA,IAAI,gBAAgB,wBAAW;AAC3B,YAAQ,MADmB,EAAX,CAApB;;;AAIA,IAAI,iBAAiB,yBAArB;;AAEA;AACK,GADL,CACS,0BAAQ,6BAAU,eAAK,IAAL,CAAU,SAAV,EAAqB,QAArB,CAAV,EAA0C;AACnD,gBAAY,EADuC,EAA1C,CAAR,CADT;AAGS;AAHT,CAIK,GAJL,CAIS,0BAAQ,8BAAR,CAJT,EAIgC;AAJhC,CAKK,GALL,CAKS,0BAAQ,wBAAR,CALT;AAMK,GANL,CAMS,0BAAQ,0BAAR,CANT,EAM4B;AAN5B,CAOK,GAPL,CAOS,yBAPT,E,CAOqB;;AAErB;AACA,IAAI,GAAJ,CAAQ,wBAAM,eAAK,IAAL,CAAU,SAAV,EAAqB,UAArB,CAAN,EAAwC;AAC5C,eAAW,MADiC,EAAxC,CAAR;;;AAIA;AACA,0BAAW,GAAX,EAAgB;AACZ,cAAU,gBADE,EAAhB;;;AAIA;AACA,IAAI,GAAJ,oFAAQ,iBAAM,GAAN,EAAW,IAAX;AACE,6BADF,GACU,IAAI,IAAJ,EADV;AAEE,kCAFF;AAGE,0BAHF,GAGO,IAAI,IAAJ,KAAa,KAHpB;AAIJ,gCAAQ,GAAR,CAAe,IAAI,MAAnB,SAA6B,IAAI,GAAjC,WAA0C,EAA1C,SAJI,mEAAR;;;AAOA;AACA,IAAI,IAAJ,GAAW,CAAC,MAAD,EAAS,WAAT,CAAX;AACA;AACA,IAAI,GAAJ,CAAQ,0BAAQ,iCAAQ;AACpB,WAAO,sCADa,EAAR,CAAR,CAAR;;;;AAKA;AACA,IAAI,GAAJ,CAAQ,cAAc,MAAd,EAAR,EAAgC,cAAc,cAAd,EAAhC;;AAEA;AACA;AACA;;;AAGA,uBAAc,aAAd;AACI;;AAEJ;AACA,IAAI,GAAJ,qFAAQ,kBAAM,GAAN;AACJ,4BAAI,MAAJ,GAAa,GAAb,CADI;AAEE,gCAAI,MAAJ,CAAW,KAAX,CAFF,uEAAR;;;AAKA;AACA,IAAI,EAAJ,CAAO,OAAP,sFAAgB,kBAAM,GAAN,EAAW,GAAX;AACZ,gCAAQ,GAAR,CAAY,gBAAZ,EAA8B,GAA9B,EADY,qEAAhB;;;AAIA,IAAM,OAAO,SAAS,MAAT,CAAb;AACA,IAAM,SAAS,eAAK,YAAL,CAAkB,IAAI,QAAJ,EAAlB,CAAf;;AAEA,OAAO,MAAP,CAAc,IAAd;AACA,OAAO,EAAP,CAAU,OAAV,EAAmB,UAAC,KAAD,EAAW;AAC1B,QAAI,MAAM,OAAN,KAAkB,QAAtB,EAAgC;AAC5B,cAAM,KAAN;AACH;AACD;AACA,YAAQ,MAAM,IAAd;AACI,aAAK,QAAL;AACI,oBAAQ,KAAR,CAAc,OAAO,+BAArB;AACA,oBAAQ,IAAR,CAAa,CAAb;AACA;AACJ,aAAK,YAAL;AACI,oBAAQ,KAAR,CAAc,OAAO,oBAArB;AACA,oBAAQ,IAAR,CAAa,CAAb;AACA;AACJ;AACI,kBAAM,KAAN,CAVR;;AAYH,CAjBD;AAkBA,OAAO,EAAP,CAAU,WAAV,EAAuB,YAAM;AACzB,YAAQ,GAAR,CAAY,uBAAZ,EAAqC,IAArC;AACH,CAFD,E;;AAIe,G","file":"app.js","sourcesContent":["/*\r\n * @Author: fengyun2\r\n * @Date:   2016-07-16 19:39:57\r\n * @Last Modified by:   fengyun2\r\n * @Last Modified time: 2016-07-21 13:26:25\r\n */\r\n\r\n/**\r\n * 主入口文件\r\n */\r\n'use strict'\r\nimport http from 'http'\r\nimport Koa from 'koa'\r\nimport Router from 'koa-router'\r\nimport path from 'path'\r\nimport views from 'koa-views'\r\nimport convert from 'koa-convert'\r\nimport json from 'koa-json'\r\nimport bodyParser from 'koa-bodyparser'\r\nimport logger from 'koa-logger'\r\nimport koaStatic from 'koa-static-plus'\r\nimport koaOnError from 'koa-onerror'\r\nimport session from 'koa-generic-session'\r\nimport MongoStore from 'koa-generic-session-mongo'\r\n\r\n/*引入路由文件*/\r\n\r\n// import index from './routes/index'\r\n// import users from './routes/users'\r\n\r\nimport backendRoutes from './routes/backend'\r\n\r\n// import frontendRoutes from './routes/frontend'\r\n\r\nimport { response } from './middlewares/response'\r\n\r\nconst app = new Koa()\r\n\r\nlet backendRouter = new Router({\r\n    prefix: \"/api\"\r\n});\r\n\r\nlet frontendRouter = new Router();\r\n\r\napp\r\n    .use(convert(koaStatic(path.join(__dirname, 'public'), {\r\n        pathPrefix: ''\r\n    }))) // 静态文件指定中间件\r\n    .use(convert(bodyParser())) // post请求解析中间件\r\n    .use(convert(json()))\r\n    .use(convert(logger())) // 日志中间件\r\n    .use(response()) // 定制报文格式\r\n\r\n// views\r\napp.use(views(path.join(__dirname, '../views'), {\r\n    extension: 'html'\r\n}))\r\n\r\n// 500 error\r\nkoaOnError(app, {\r\n    template: 'views/500.html'\r\n})\r\n\r\n// logger\r\napp.use(async(ctx, next) => {\r\n    const start = new Date()\r\n    await next()\r\n    const ms = new Date() - start\r\n    console.log(`${ctx.method} ${ctx.url} - ${ms}ms`)\r\n})\r\n\r\n//设置一个签名 Cookie 的秘钥,也可以借助KeyGrip生成你想的一个实例\r\napp.keys = ['keys', 'koa2-blog'];\r\n//setting session\r\napp.use(convert(session({\r\n    store: new MongoStore()\r\n})));\r\n\r\n\r\n// 路由中间件\r\napp.use(backendRouter.routes(), backendRouter.allowedMethods())\r\n\r\n// router config\r\n// router.use('/', index.routes())\r\n// router.use('/users', users.routes())\r\n\r\n\r\nbackendRoutes(backendRouter)\r\n    // frontendRoutes(frontendRouter)\r\n\r\n// 404\r\napp.use(async(ctx) => {\r\n    ctx.status = 404\r\n    await ctx.render('404')\r\n})\r\n\r\n// error logger\r\napp.on('error', async(err, ctx) => {\r\n    console.log('error occured:', err)\r\n})\r\n\r\nconst port = parseInt('3000')\r\nconst server = http.createServer(app.callback())\r\n\r\nserver.listen(port)\r\nserver.on('error', (error) => {\r\n    if (error.syscall !== 'listen') {\r\n        throw error\r\n    }\r\n    // handle specific listen errors with friendly messages\r\n    switch (error.code) {\r\n        case 'EACCES':\r\n            console.error(port + ' requires elevated privileges')\r\n            process.exit(1)\r\n            break\r\n        case 'EADDRINUSE':\r\n            console.error(port + ' is already in use')\r\n            process.exit(1)\r\n            break\r\n        default:\r\n            throw error\r\n    }\r\n})\r\nserver.on('listening', () => {\r\n    console.log('Listening on port: %d', port)\r\n})\r\n\r\nexport default app"]}