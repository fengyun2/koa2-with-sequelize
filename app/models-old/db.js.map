{"version":3,"sources":["../../src/models-old/db.js"],"names":[],"mappings":"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","file":"db.js","sourcesContent":["const\r\n    MongoClient = require('mongodb').MongoClient,\r\n    assert = require('assert'),\r\n    config = require('../config/mongodb'),\r\n    ObjectID = require('mongodb').ObjectID\r\n\r\nconst mongoLink = `mongodb://${config.host}:${config.port}/${config.database}`\r\n\r\n// 插入方法\r\nconst insert = (collectionName, obj) => {\r\n    return new Promise((resolve, reject) => {\r\n        MongoClient.connect(mongoLink, (err, db) => {\r\n            if (err) reject(err)\r\n            const collection = db.collection(collectionName)\r\n            collection.insert(obj, {\r\n                w: 1\r\n            }, (err, res) => {\r\n                db.close()\r\n                if (err) reject(err)\r\n                else resolve(res[0])\r\n            })\r\n        })\r\n    })\r\n}\r\n\r\n// 更新\r\nconst update = (collectionName, obj) => {\r\n    return new Promise((resolve, reject) => {\r\n        MongoClient.connect(mongoLink, (err, db) => {\r\n            if (err) reject(err)\r\n            const collection = db.collection(collectionName)\r\n            collection.update({\r\n                _id: new ObjectID(obj._id)\r\n            }, obj, {\r\n                upsert: true,\r\n                w: 1\r\n            }, (err, res) => {\r\n                db.close()\r\n                if (err) reject(err)\r\n                else resolve(res)\r\n            })\r\n        })\r\n    });\r\n}\r\n\r\n// 查找一个\r\nconst findOne = (collectionName, query, option) => {\r\n    return new Promise((resolve, reject) => {\r\n        MongoClient.connect(mongoLink, (err, db) => {\r\n            if (err) reject(err)\r\n            const collection = db.collection(collectionName)\r\n            if (option == undefined || option == null) {\r\n                collection.findOne(query, (err, res) => {\r\n                    db.close()\r\n                    if (err) reject(err)\r\n                    else resolve(res)\r\n                })\r\n            } else {\r\n                collection.findOne(query, option, (err, res) => {\r\n                    db.close()\r\n                    if (err) reject(err)\r\n                    else resolve(res)\r\n                })\r\n            }\r\n        })\r\n    })\r\n}\r\n\r\n// 查找多个\r\nconst find = (collectionName, query, option) => {\r\n    return new Promise((resolve, reject) => {\r\n        MongoClient.connect(mongoLink, (err, db) => {\r\n            if (err) reject(err)\r\n            const collection = db.collection(collectionName)\r\n            if (option == undefined || option == null) {\r\n                collection.find(query).toArray((err, res) => {\r\n                    db.close()\r\n                    if (err) reject(err)\r\n                    else resolve(res)\r\n                })\r\n            } else {\r\n                collection.find(query, option).toArray((err, res) => {\r\n                    db.close()\r\n                    if (err) reject(err)\r\n                    else resolve(res)\r\n                })\r\n            }\r\n        })\r\n    });\r\n}\r\n\r\n// 删除\r\nconst remove = (collectionName, query) => {\r\n    return new Promise((resolve, reject) => {\r\n        MongoClient.connect(mongoLink, (err, db) => {\r\n            if (err) reject(err)\r\n            const collection = db.collection(collectionName)\r\n            collection.remove(query, {\r\n                w: 1\r\n            }, (err, res) => {\r\n                db.close()\r\n                if (err) reject(err)\r\n                else resolve(res)\r\n            })\r\n        })\r\n    })\r\n}\r\n\r\n// 计数\r\nconst count = (collectionName, query, option) => {\r\n    return new Promise((resolve, reject) => {\r\n        MongoClient.connect(mongoLink, (err, db) => {\r\n            if (err) reject(err)\r\n            const collection = db.collection(collectionName)\r\n            if (option == undefined || option == null) {\r\n                collection.count(query, (err, count) => {\r\n                    db.close()\r\n                    if (err) reject(err)\r\n                    else resolve(count)\r\n                })\r\n            } else {\r\n                collection.count(query, option, (err, count) => {\r\n                    db.close()\r\n                    if (err) reject(err)\r\n                    else resolve(count)\r\n                })\r\n            }\r\n        })\r\n    })\r\n}\r\n\r\nmodule.exports.insert = insert\r\nmodule.exports.update = update\r\nmodule.exports.findOne = findOne\r\nmodule.exports.find = find\r\nmodule.exports.remove = remove\r\nmodule.exports.count = count\r\n"]}